# 🎯 Simple Configuration System

ExcelDraw uses a **centralized configuration system** where all environment variables are managed in one place and imported where needed.

## 🏗️ Architecture Overview

```
┌─────────────────────────────────────────────────────────────┐
│                    Single .env File                         │
│                 (Project Root)                              │
└─────────────────────┬───────────────────────────────────────┘
                      │
                      ▼
┌─────────────────────────────────────────────────────────────┐
│              packages/common/src/config.ts                  │
│              (Centralized Configuration)                    │
└─────────────────────┬───────────────────────────────────────┘
                      │
        ┌─────────────┼─────────────┐
        │             │             │
        ▼             ▼             ▼
┌─────────────┐ ┌─────────────┐ ┌─────────────┐
│ Backend     │ │ Frontend    │ │ WebSocket   │
│ Common      │ │ Config      │ │ Server      │
│ Config      │ │             │ │             │
└─────────────┘ └─────────────┘ └─────────────┘
```

## 🚀 Quick Start

### 1. Setup Configuration
```bash
# Automated setup (recommended)
./setup-config.sh

# Or manual setup
touch .env
# Then add configuration values
```

### 2. Update Values
Edit `.env` file with your specific values:
- Database URL
- JWT Secret (auto-generated by script)
- Ports (if different from defaults)

### 3. Start Services
```bash
pnpm dev
```

## 📁 File Structure

```
├── .env                          # Single configuration file
├── setup-config.sh               # Automated setup script
├── packages/
│   └── common/
│       └── src/
│           └── config.ts         # Centralized configuration
├── packages/
│   └── backend-common/
│       └── src/
│           └── config.ts         # Re-exports from common
└── apps/
    └── exceldraw-frontend/
        └── config.ts             # Re-exports from common
```

## 🔧 Configuration Options

### Database
```env
DATABASE_URL=postgresql://postgres:mysecretpassword@localhost/draw-app
```

### Security
```env
JWT_SECRET=your-super-secret-jwt-key-here
```

### Server Ports
```env
HTTP_PORT=4000
WS_PORT=8080
```

### Frontend URLs
```env
NEXT_PUBLIC_HTTP_BACKEND=http://localhost:4000/api/v1
NEXT_PUBLIC_WS_URL=ws://localhost:8080
```

### Avatar Services
```env
NEXT_PUBLIC_AVATAR_PRIMARY_URL=https://avatar.iran.liara.run/public
NEXT_PUBLIC_AVATAR_FALLBACK_URL=https://ui-avatars.com/api
```

### Production Settings
```env
NODE_ENV=production
CORS_ORIGIN=https://your-domain.com
LOG_LEVEL=error
```

## 🎯 Benefits

### ✅ Single Source of Truth
- All configuration in one place
- No configuration drift between services
- Easy to manage and update

### ✅ Type Safety
- Full TypeScript support
- Compile-time validation
- IntelliSense support

### ✅ Validation
- Configuration validation on startup
- Clear error messages for missing values
- Production safety checks

### ✅ Easy Deployment
- Single .env file for all services
- Environment-specific templates
- Production-ready defaults

### ✅ Developer Experience
- Automated setup script
- Clear documentation
- Consistent imports across services

## 🔄 Migration from Old System

The old system had separate .env files in each service directory. The new system:

1. **Consolidates** all configuration into a single `.env` file
2. **Centralizes** configuration logic in `packages/common/src/config.ts`
3. **Re-exports** configuration from each service's config file
4. **Validates** configuration on startup
5. **Provides** type-safe access to all configuration values

## 🚀 Production Deployment

### 1. Copy Production Template
```bash
cp env.production .env
```

### 2. Update Production Values
```env
DATABASE_URL=postgresql://user:pass@prod-db:5432/draw-app
JWT_SECRET=your-production-secret
NEXT_PUBLIC_HTTP_BACKEND=https://api.yourdomain.com/api/v1
NEXT_PUBLIC_WS_URL=wss://ws.yourdomain.com
NODE_ENV=production
CORS_ORIGIN=https://yourdomain.com
```

### 3. Deploy
All services will automatically use the centralized configuration.

## 🛠️ Development

### Adding New Configuration
1. Add to `packages/common/src/config.ts`
2. Add to `.env` templates
3. Update validation if needed
4. Services automatically get access via re-exports

### Using Configuration
```typescript
// In any service
import { config, DATABASE_URL, JWT_SECRET } from "@repo/common/config";

// Use individual values
console.log(DATABASE_URL);

// Use config object
console.log(config.database.url);
console.log(config.app.isProduction);
```

## 🔍 Troubleshooting

### Module Resolution Issues
- Ensure `@repo/common` is in package.json dependencies
- Run `pnpm install` to update workspace dependencies
- Check TypeScript configuration includes Node types

### Configuration Validation Errors
- Check `.env` file exists and has required values
- Verify JWT_SECRET is set (not default value in production)
- Ensure DATABASE_URL is properly formatted

### Production Issues
- Use `env.production` template
- Set strong JWT_SECRET
- Update all URLs to production domains
- Set NODE_ENV=production

## 📚 Related Files

- `ENV_SETUP.md` - Detailed setup instructions
- `packages/common/src/config.ts` - Centralized configuration
- `setup-config.sh` - Automated setup script
- `env.development` - Development template
- `env.production` - Production template
